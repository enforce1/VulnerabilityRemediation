# ALPHA - 134204 â€“ MS15-124: Cumulative Security Update For Internet Explorer (CVE-2015-6161) (3125869)

# MS15-124: Cumulative Security Update for Internet Explorer (CVE-2015-6161) (3125869) (134204)
# Synopsis
# The remote host has a web browser installed that is affected by multiple vulnerabilities.
# Description
# The version of Internet Explorer installed on the remote host is missing Cumulative Security Update 3125869 and/or a Registry key to prevent the host against CVE-2015-6161. It is, therefore, affected by Microsoft Internet Explorer 7 through 11 and Microsoft Edge allow remote attackers to bypass the ASLR protection mechanism via a crafted web site, aka 'Microsoft Browser ASLR Bypass'.
# An unauthenticated, remote attacker can exploit this issue by convincing a user to visit a specially craftedwebsite, resulting in the execution of arbitrary code in the context of the current user.
# An specific Fix to Run from Microsoft or a registry value must be added to enable the fix for CVE-2015-6161.
# Solution
# Microsoft has released a set of patches for Windows Vista, 2008, 7, 2008 R2, 8, RT, 2012, 8.1, RT 8.1, 2012 R2, and 10.
# Refer to KB3125869 for additional information.

# Got some help from https://aventistech.com/kb/fixes-for-vulnerabilities-detected-by-nessus/

# Windows Speculative Execution Configuration Check (132101)
# SPECTRE / MELTDOWN
# Synopsis
# The remote host has not properly mitigated a series of speculative execution vulnerabilities.

# Description
# The remote host has not properly mitigated a series of known speculative execution vulnerabilities. It, therefore, may be affected by :
# - Branch Target Injection (BTI) (CVE-2017-5715)
# - Bounds Check Bypass (BCB) (CVE-2017-5753)
# - Rogue Data Cache Load (RDCL) (CVE-2017-5754)
# - Rogue System Register Read (RSRE) (CVE-2018-3640)
# - Speculative Store Bypass (SSB) (CVE-2018-3639)
# - L1 Terminal Fault (L1TF) (CVE-2018-3615, CVE-2018-3620, CVE-2018-3646)
# - Microarchitectural Data Sampling Uncacheable Memory (MDSUM) (CVE-2019-11091)
# - Microarchitectural Store Buffer Data Sampling (MSBDS) (CVE-2018-12126)
# - Microarchitectural Load Port Data Sampling (MLPDS) (CVE-2018-12127)
# - Microarchitectural Fill Buffer Data Sampling (MFBDS) (CVE-2018-12130)
# - TSX Asynchronous Abort (TAA) (CVE-2019-11135)

# Solution
# Apply vendor recommended settings.

# Recommended Settings 2:
#   - SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\
#     FeatureSettingsOverrideMask: 0x00000003 (3)
#   - SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\
#     FeatureSettingsOverride: 0x00000048 (72)
#   CVEs Covered:
#     CVE-2017-5715, CVE-2017-5753, CVE-2017-5754, CVE-2018-3615, CVE-2018-3620,
#     CVE-2018-3639, CVE-2018-3646, CVE-2018-11091, CVE-2018-12126, CVE-2018-12127,
#     CVE-2018-12130, CVE-2019-11135
#   Note: Hyper-Threading enabled.
#   Note: Most protections enabled by default on clients. Required for CVE-2018-3639.

# NOTE: This assumes hyper-threading remains enabled. Your mileage may vary if you run with HT Disabled. This is not tested on Windows 7 or 8!


# Figures out what architecture we are running on. No accomodation for ARM (since I don't own any!)
$SC_Architecture = ($env:PROCESSOR_ARCHITECTURE)

If (($SC_Architecture) -ne "X86") {

 #32 Bits
New-Item -Path 'HKLM:\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl' -Name 'FEATURE_ALLOW_USER32_EXCEPTION_HANDLER_HARDENING'
New-ItemProperty -Path 'HKLM:\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ALLOW_USER32_EXCEPTION_HANDLER_HARDENING' `
-Name 'iexplore.exe' -Value '00000001' -PropertyType 'Dword' -Force
}
Else
{
#64 Bits
New-Item -Path 'HKLM:\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl' -Name 'FEATURE_ALLOW_USER32_EXCEPTION_HANDLER_HARDENING'
 'HKLM:New-ItemProperty -Path\SOFTWARE\WOW6432Node\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_ALLOW_USER32_EXCEPTION_HANDLER_HARDENING' `
-Name 'iexplore.exe' -Value '00000001' -PropertyType 'Dword' -Force
}

