:: Windows Speculative Execution Configuration Check (132101)
:: SPECTRE / MELTDOWN
:: Synopsis
:: The remote host has not properly mitigated a series of speculative execution vulnerabilities.

:: Description
:: The remote host has not properly mitigated a series of known speculative execution vulnerabilities. It, therefore, may be affected by :
:: - Branch Target Injection (BTI) (CVE-2017-5715)
:: - Bounds Check Bypass (BCB) (CVE-2017-5753)
:: - Rogue Data Cache Load (RDCL) (CVE-2017-5754)
:: - Rogue System Register Read (RSRE) (CVE-2018-3640)
:: - Speculative Store Bypass (SSB) (CVE-2018-3639)
:: - L1 Terminal Fault (L1TF) (CVE-2018-3615, CVE-2018-3620, CVE-2018-3646)
:: - Microarchitectural Data Sampling Uncacheable Memory (MDSUM) (CVE-2019-11091)
:: - Microarchitectural Store Buffer Data Sampling (MSBDS) (CVE-2018-12126)
:: - Microarchitectural Load Port Data Sampling (MLPDS) (CVE-2018-12127)
:: - Microarchitectural Fill Buffer Data Sampling (MFBDS) (CVE-2018-12130)
:: - TSX Asynchronous Abort (TAA) (CVE-2019-11135)

:: Solution
:: Apply vendor recommended settings.

:: Recommended Settings 2:
::   - SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\
::     FeatureSettingsOverrideMask: 0x00000003 (3)
::   - SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management\
::     FeatureSettingsOverride: 0x00000048 (72)
::   CVEs Covered:
::     CVE-2017-5715, CVE-2017-5753, CVE-2017-5754, CVE-2018-3615, CVE-2018-3620,
::     CVE-2018-3639, CVE-2018-3646, CVE-2018-11091, CVE-2018-12126, CVE-2018-12127,
::     CVE-2018-12130, CVE-2019-11135
::   Note: Hyper-Threading enabled.
::   Note: Most protections enabled by default on clients. Required for CVE-2018-3639.

:: NOTE: This assumes hyper-threading remains enabled. Your mileage may vary if you run with HT Disabled. This is not tested on Windows 7 or 8!

reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v FeatureSettingsOverride /t REG_DWORD /d 00002048 /f

reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v FeatureSettingsOverrideMask /t REG_DWORD /d 00000003 /f
